language: php

sudo: false

php:
  - 7.0

cache:
  directories:
    - $HOME/.composer/cache

before_script:
  - travis_retry composer install

deploy:
  provider: script
  script: >-
    curl -s -X POST
    -H "Content-Type: application/json"
    -H "Accept: application/json"
    -H "Travis-API-Version: 3"
    -H "Authorization: token ${TRAVIS_TOKEN}"
    -d '{"request": {"message": "Deploy opendata.ch", "branch": "master", "config": {"deploy": {"provider": "script", "skip_cleanup": "true", "script": "ansible-playbook deploy-opendata-ch.yml"}}}}'
    https://api.travis-ci.org/repo/OpendataCH%2Fplaybook/requests
  on:
    branch: master
